import{_ as k,o as d,c as h,a as e,w as f,t as _,n as m,b as c,d as r,v as p,S,e as A,l as U,f as y,g as L,h as M,m as P,r as b,i as g,j as F,T as B,k as E,F as w,p as v,q as N,s as V,u as T}from"./index.12736e53.js";const O={name:"ChangesModal",emits:["reloadExpenses"],props:{expense_id:Number,expense_purpose:String,expense_client:String,expense_amount:Number},data(){return{update_expense_submit:"Save changes",action:null,show:!1,type:"",message:""}},methods:{closeModal(){this.$emit("reloadExpenses"),document.getElementById("changes-modal").style.display="none"},async updateExpense(){this.action="submitting",this.update_expense_submit="";let n=this.expense_purpose.toLocaleLowerCase();const s={id:this.expense_id,purpose:n,expense_client:this.expense_client,amount:this.expense_amount};try{const a=`${this.$api}expenses/${this.expense_id}`,t=await(await fetch(a,{method:"PATCH",headers:{"Content-Type":"application/json",auth_token:this.$store.getters.AuthToken},body:JSON.stringify(s)})).json();t.status===200?(this.message=t.data,this.type="success",this.show=!0,setTimeout(()=>{this.type="none",this.message=""},5e3)):(this.message=t.error,this.type="error")}catch(a){return a}this.action="",this.update_expense_submit="Save changes"}}},D={class:"backdrop",id:"changes-modal"},R={class:"modal"},j={class:"item-to-update"},q=e("h4",{class:"center-text"},"Update the expense below",-1),K=e("div",{class:"items-list"},[e("ul",null,[e("li",null,[e("label",{class:"li-label"},"Purpose")]),e("li",null,[e("label",{class:"li-label"},"Amount")])])],-1),I={class:"items"},G=e("br",null,null,-1),J=e("hr",null,null,-1),Y=["message"],X=e("label",null,"Purpose",-1),z=e("label",null,"Client",-1),H=e("label",null,"Amount",-1),Q=e("p",{class:"center-text"},[e("span",null,"Make sure you save your changes to the database")],-1);function W(n,s,a,i,t,l){return d(),h("div",D,[e("div",R,[e("button",{class:"round-button",onClick:s[0]||(s[0]=f((...u)=>l.closeModal&&l.closeModal(...u),["self"]))}),e("div",j,[q,K,e("div",I,[e("ul",null,[e("li",null,_(a.expense_purpose),1),e("li",null,_(a.expense_amount),1)])]),G,J,t.show?(d(),h("div",{key:0,class:m([t.type,"changes-notif"]),message:t.message},_(t.message),11,Y)):c("",!0),e("form",{onSubmit:s[5]||(s[5]=f((...u)=>l.updateExpense&&l.updateExpense(...u),["prevent"])),class:"dash"},[r(e("input",{type:"hidden","onUpdate:modelValue":s[1]||(s[1]=u=>a.expense_id=u)},null,512),[[p,a.expense_id]]),X,r(e("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=u=>a.expense_purpose=u)},null,512),[[p,a.expense_purpose]]),z,r(e("input",{type:"text","onUpdate:modelValue":s[3]||(s[3]=u=>a.expense_client=u)},null,512),[[p,a.expense_client]]),H,r(e("input",{type:"number","onUpdate:modelValue":s[4]||(s[4]=u=>a.expense_amount=u),min:"0",step:"0.01"},null,512),[[p,a.expense_amount]]),e("button",{class:m([t.action,"submit dashboard-submit"])},_(t.update_expense_submit),3)],32),Q])])])}var Z=k(O,[["render",W]]);const $={name:"Dashboard",components:{ShowAlert:S,ChangesModal:Z},data(){return{changesModalProps:{expense_id:0,expense_purpose:"",expense_client:"",expense_amount:0},type:null,message:null,show:!1,action:null,expense_for:null,flo_amount_foreman:0,flo_foreman_submit:"Add expense",expenses_by_flo:[],all_expenses_by_flo:[],expenses_by_foreman:[],all_expenses_by_foreman:[],foreman_balances:[],flo_purpose_other:"",flo_client_other:"",flo_amount_other:0,foreman_purpose:"",foreman_client:"",foreman_amount:0,expense_to:null,all_expenses:[],todays_expenses:[],dated_expenses:[],flo_start_date:null,flo_end_date:null,flo_expenses_report:"Get report",foreman_start_date:null,foreman_end_date:null,foreman_expenses_report:"Get report",monies_to_start_date:null,monies_to_end_date:null,monies_to_report:"Get report",flo_other_submit:"Add expense",foreman_expenses_submit:"Add expense",new_batch_submit:"Upload file"}},computed:{foremanMoniesBalance(){let n=0,s=0;return this.foreman_balances.forEach(a=>{n+=a.amount}),this.all_expenses_by_foreman.forEach(a=>{s+=a.amount}),n-s},floTotalExpenses(){let n=0;return this.all_expenses_by_flo.forEach(s=>{n+=s.amount}),n}},methods:{openAction:A,loadToast:U,todaysDate:y,floExpensesReportByDate:L,foremanExpensesReportByDate:M,moniesToForemanReportByDate:P,async uploadBatchExpenses(){this.action="submitting",this.new_batch_submit="";let n=document.getElementById("newExpenseFile");const s=new FormData;s.append("newExpenseFile",n.files[0]),s.append("expense_for",this.expense_for);try{const a=`${this.$api}expenses/upload`,t=await(await fetch(a,{method:"POST",headers:{auth_token:this.$store.getters.AuthToken},body:s})).json();t.status===200?(this.message=t.data,this.type="success",this.loadToast(this.message,this.type)):(this.message=t.error,this.type="error",this.loadToast(this.message,this.type))}catch{let i="The server is offline or unreachable.";this.loadToast(i,"error")}this.action="",this.new_batch_submit="Upload file"},async addFloExpenseToForeman(){const n={expense_for:"flo",purpose:"foreman",expense_client:"foreman",amount:this.flo_amount_foreman};this.action="submitting",this.flo_foreman_submit="";const s=`${this.$api}expenses`,i=await(await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",auth_token:this.$store.getters.AuthToken},body:JSON.stringify(n)})).json();i.status===201?(this.flo_amount_foreman="",this.message="Expense added successfully",this.loadToast(this.message,"success"),await this.get_flo_expenses()):this.loadToast(i.error,"error"),this.action="",this.flo_foreman_submit="Add expense"},async addFloExpenseToOther(){const n={expense_for:"flo",purpose:this.flo_purpose_other,expense_client:this.flo_client_other,amount:this.flo_amount_other};this.action="submitting",this.flo_other_submit="";const s=`${this.$api}expenses`,i=await(await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",auth_token:this.$store.getters.AuthToken},body:JSON.stringify(n)})).json();i.status===201?(this.message="Expense added successfully",this.loadToast(this.message,"success"),this.flo_amount_other="",this.flo_purpose_other="",this.flo_client_other="",await this.get_flo_expenses()):this.loadToast(i.error,"error"),this.action="",this.flo_other_submit="Add expense"},async addForemanExpenses(){const n={expense_for:"foreman",purpose:this.foreman_purpose,expense_client:this.foreman_client,amount:this.foreman_amount};this.action="submitting",this.foreman_expenses_submit="";const s=`${this.$api}expenses`,i=await(await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",auth_token:this.$store.getters.AuthToken},body:JSON.stringify(n)})).json();i.status===201?(this.message="Expense added successfully",this.loadToast(this.message,"success"),this.foreman_amount="",this.foreman_purpose="",this.foreman_client="",await this.get_foreman_expenses()):this.loadToast(i.error,"error"),this.action="",this.foreman_expenses_submit="Add expense"},async get_flo_expenses(){await this.get_todays_expenses(),this.expenses_by_flo=this.todays_expenses.filter(n=>n.expense_for.toLocaleLowerCase().trim()==="flo"&&n.expense_date===y()),await this.$store.dispatch("getAllExpenses"),this.all_expenses=this.$store.getters.AllExpenses,this.all_expenses_by_flo=this.all_expenses.filter(n=>n.expense_for.toLocaleLowerCase().trim()==="flo")},async get_foreman_expenses(){await this.get_todays_expenses(),this.expenses_by_foreman=this.todays_expenses.filter(n=>n.expense_for.toLocaleLowerCase().trim()==="foreman"&&n.expense_date==y()),await this.$store.dispatch("getAllExpenses"),this.all_expenses=this.$store.getters.AllExpenses,this.foreman_balances=this.all_expenses.filter(n=>{let s=n.expense_for.toLocaleLowerCase(),a=n.purpose.toLocaleLowerCase();return s.trim()==="flo"&&a.trim()==="foreman"}),this.all_expenses_by_foreman=this.all_expenses.filter(n=>n.expense_for.toLocaleLowerCase().trim()==="foreman")},async remove_flo_expenses(n){if(confirm("Are you sure you want to delete this expense ?")){const s=`${this.$api}expenses/${n}`,i=await(await fetch(s,{method:"DELETE",headers:{"Content-Type":"application/json",auth_token:this.$store.getters.AuthToken}})).json();i.status===200?(this.loadToast("Expense removed successfully","success"),await this.get_flo_expenses()):this.loadToast(i.error,"error")}},async remove_foreman_expenses(n){if(confirm("Are you sure you want to delete this expense ?")){const s=`${this.$api}expenses/${n}`,i=await(await fetch(s,{method:"DELETE",headers:{"Content-Type":"application/json",auth_token:this.$store.getters.AuthToken}})).json();i.status===200?(this.loadToast("Expense removed successfully","success"),await this.get_foreman_expenses()):this.loadToast(i.error,"error")}},async get_dated_expenses(n,s){try{const a=`${this.$api}expenses/${n}/${s}`,t=await(await fetch(a,{method:"GET",headers:{auth_token:this.$store.getters.AuthToken}})).json();t.status===200?(this.dated_expenses=t.data,this.message="Report data fetched successfully, please wait for report to render.",this.type="success",this.loadToast(this.message,this.type)):t.status===404&&(this.message=`
                    No data was found for the given dates
                     or enter correct dates and try again`,this.type="error",this.loadToast(this.message,this.type))}catch{this.message=`
                There was an error fetching the report.
                `,this.type="error",this.loadToast(this.message,this.type)}},async edit_flo_expenses(n){document.getElementById("changes-modal").style.display="block",this.changesModalProps.expense_id=n.id,this.changesModalProps.expense_purpose=n.purpose,this.changesModalProps.expense_client=n.expense_client,this.changesModalProps.expense_amount=n.amount},async edit_foreman_expenses(n){document.getElementById("changes-modal").style.display="block",this.changesModalProps.expense_id=n.id,this.changesModalProps.expense_purpose=n.purpose,this.changesModalProps.expense_client=n.expense_client,this.changesModalProps.expense_amount=n.amount},async clearExpensesAndUpdate(){await this.get_flo_expenses(),await this.get_foreman_expenses()},async get_todays_expenses(){await this.$store.dispatch("getTodaysExpenses"),this.todays_expenses=this.$store.getters.TodaysExpenses},async get_expenses_by_flo_report(){this.dated_expenses.length=0,this.action="submitting",this.flo_expenses_report="",await this.get_dated_expenses(this.flo_start_date,this.flo_end_date);const n=this.dated_expenses.filter(a=>a.expense_for.toLocaleLowerCase().trim()==="flo");let s=[{header:"PURPOSE",dataKey:"purpose"},{header:"CLIENT",dataKey:"expense_client"},{header:"AMOUNT",dataKey:"amount"},{header:"EXPENSED ON",dataKey:"expense_date"}];this.floExpensesReportByDate(n,s,this.flo_start_date,this.flo_end_date),this.action="",this.flo_expenses_report="Get report"},async get_foreman_expenses_report(){this.dated_expenses.length=0,this.action="submitting",this.foreman_expenses_report="",await this.get_dated_expenses(this.foreman_start_date,this.foreman_end_date);const n=this.dated_expenses.filter(a=>a.expense_for.toLocaleLowerCase().trim()==="foreman");let s=[{header:"PURPOSE",dataKey:"purpose"},{header:"CLIENT",dataKey:"expense_client"},{header:"AMOUNT",dataKey:"amount"},{header:"EXPENSED ON",dataKey:"expense_date"}];this.foremanExpensesReportByDate(n,s,this.foreman_start_date,this.foreman_end_date),this.action="",this.foreman_expenses_report="Get report"},async get_monies_to_foreman_report(){this.dated_expenses.length=0,this.action="submitting",this.monies_to_report="",await this.get_dated_expenses(this.monies_to_start_date,this.monies_to_end_date);const n=this.dated_expenses.filter(a=>{let i=a.expense_for.toLocaleLowerCase(),t=a.purpose.toLocaleLowerCase();return i.trim()==="flo"&&t.trim()==="foreman"});let s=[{header:"PURPOSE",dataKey:"purpose"},{header:"CLIENT",dataKey:"expense_client"},{header:"AMOUNT",dataKey:"amount"},{header:"EXPENSED ON",dataKey:"expense_date"}];this.moniesToForemanReportByDate(n,s,this.monies_to_start_date,this.monies_to_end_date),this.action="",this.monies_to_report="Get report"}},async created(){await this.$store.dispatch("getAllExpenses"),this.all_expenses=this.$store.getters.AllExpenses},mounted(){document.getElementById("changes-modal").style.display="none"}},ee={class:"actions"},se={class:"actionContent",id:"batchExpense"},te=e("h4",null,"Upload batch expenses",-1),oe=e("p",null,"Batch expenses and upload them in a file",-1),ne=e("hr",null,null,-1),ae=e("label",null,"Select expense type",-1),le=e("option",{value:"flo"},"Flo",-1),ie=e("option",{value:"foreman"},"Foreman",-1),re=[le,ie],_e=e("label",null,"Batch file",-1),pe=e("input",{type:"file",class:"file",id:"newExpenseFile",accept:".xlsx, .xls",required:""},null,-1),de={class:"actionContent",id:"floExpense"},ue=e("h4",null,"Your expenses",-1),he=e("p",null,"Add expenses made by you",-1),me=e("p",null,"Select who you are expensing / paying to foreman or other",-1),ce=e("hr",null,null,-1),fe={class:"holder"},xe={class:"input-expenses"},ye={class:"holder-padding"},be=e("label",null,"Expense to",-1),ge=e("option",{value:"foreman"},"Monies to foreman",-1),Ee=e("option",{value:"other"},"Monies to other",-1),we=[ge,Ee],ve={key:0},Te=e("label",null,"Amount",-1),ke={key:1},Ce=e("label",null,"Purpose",-1),Se=e("label",null,"Client",-1),Ae=e("label",null,"Amount",-1),Ue={class:"list-expenses"},Le={class:"total-label"},Me=e("hr",null,null,-1),Pe={key:0,class:"list-expenses-li"},Fe={class:"buttons"},Be=["onClick"],Ne=["onClick"],Ve={key:1,class:"center-text bold-text"},Oe={class:"actionContent",id:"foremanExpense"},De=e("h4",null,"Foremans expenses",-1),Re=e("p",null,"Add expenses by the foreman",-1),je=e("hr",null,null,-1),qe={class:"holder"},Ke={class:"input-expenses"},Ie=e("label",null,"Purpose",-1),Ge=e("label",null,"Client",-1),Je=e("label",null,"Amount",-1),Ye={class:"list-expenses"},Xe={class:"total-label"},ze=e("hr",null,null,-1),He={key:0,class:"list-expenses-li"},Qe={class:"buttons"},We=["onClick"],Ze=["onClick"],$e={key:1,class:"center-text bold-text"},es={class:"actionContent reports-dash",id:"generateReports"},ss=e("h3",null,"Get various reports",-1),ts=e("p",null,"Show a report for a given duration, just enter the start and end date.",-1),os=e("hr",null,null,-1),ns=e("h4",null,"Your expenses",-1),as=e("label",null,"Start date",-1),ls=e("label",null,"End date",-1),is=e("hr",null,null,-1),rs=e("h4",null,"Foreman expenses",-1),_s=e("label",null,"Start date",-1),ps=e("label",null,"End date",-1),ds=e("hr",null,null,-1),us=e("h4",null,"Monies to foreman",-1),hs=e("label",null,"Start date",-1),ms=e("label",null,"End date",-1),cs=e("h4",{class:"center-text text-margin",id:"profileInstruction"},"Click on any option to carry out the task.",-1);function fs(n,s,a,i,t,l){const u=b("ShowAlert"),C=b("ChangesModal");return d(),h("main",null,[g(B,{name:"toast"},{default:F(()=>[t.show?(d(),V(u,{key:0,class:m(t.type),message:t.message},null,8,["class","message"])):c("",!0)]),_:1}),e("div",ee,[e("button",{class:"action-links",onClick:s[0]||(s[0]=o=>l.openAction(o,"batchExpense"))},"Batch"),e("button",{class:"action-links",onClick:s[1]||(s[1]=o=>(l.openAction(o,"floExpense"),l.get_flo_expenses()))},"Flo"),e("button",{class:"action-links",onClick:s[2]||(s[2]=o=>(l.openAction(o,"foremanExpense"),l.get_foreman_expenses()))},"Foreman"),e("button",{class:"action-links",onClick:s[3]||(s[3]=o=>l.openAction(o,"generateReports"))},"Reports")]),e("div",se,[te,oe,ne,e("form",{onSubmit:s[5]||(s[5]=f((...o)=>l.uploadBatchExpenses&&l.uploadBatchExpenses(...o),["prevent"])),class:"dash"},[ae,r(e("select",{"onUpdate:modelValue":s[4]||(s[4]=o=>t.expense_for=o),required:""},re,512),[[E,t.expense_for]]),_e,pe,e("button",{class:m([t.action,"submit dashboard-submit"])},_(t.new_batch_submit),3)],32)]),e("div",de,[ue,he,me,ce,e("div",fe,[e("div",xe,[e("div",ye,[be,r(e("select",{"onUpdate:modelValue":s[6]||(s[6]=o=>t.expense_to=o),class:"holder-select",required:""},we,512),[[E,t.expense_to]])]),t.expense_to==="foreman"?(d(),h("div",ve,[e("form",{onSubmit:s[8]||(s[8]=f((...o)=>l.addFloExpenseToForeman&&l.addFloExpenseToForeman(...o),["prevent"])),class:"holder-padding"},[Te,r(e("input",{type:"number","onUpdate:modelValue":s[7]||(s[7]=o=>t.flo_amount_foreman=o),required:""},null,512),[[p,t.flo_amount_foreman]]),e("button",{class:m([t.action,"submit holder-padding-submit"])},_(t.flo_foreman_submit),3)],32)])):c("",!0),t.expense_to==="other"?(d(),h("div",ke,[e("form",{onSubmit:s[12]||(s[12]=f((...o)=>l.addFloExpenseToOther&&l.addFloExpenseToOther(...o),["prevent"])),class:"holder-padding"},[Ce,r(e("input",{type:"text","onUpdate:modelValue":s[9]||(s[9]=o=>t.flo_purpose_other=o),required:""},null,512),[[p,t.flo_purpose_other]]),Se,r(e("input",{type:"text","onUpdate:modelValue":s[10]||(s[10]=o=>t.flo_client_other=o)},null,512),[[p,t.flo_client_other]]),Ae,r(e("input",{type:"number","onUpdate:modelValue":s[11]||(s[11]=o=>t.flo_amount_other=o),required:""},null,512),[[p,t.flo_amount_other]]),e("button",{class:m([t.action,"submit holder-padding-submit"])},_(t.flo_other_submit),3)],32)])):c("",!0)]),e("div",Ue,[e("label",Le,"Total expenses ="+_(l.floTotalExpenses.toLocaleString("en-US",{style:"currency",currency:"KES"})),1),Me,t.expenses_by_flo.length>0?(d(),h("div",Pe,[(d(!0),h(w,null,v(t.expenses_by_flo,o=>(d(),h("ul",{key:o.id},[e("li",null,[T(_(o.amount.toLocaleString("en-US"))+"\xA0\xA0\xA0"+_(o.purpose)+" ",1),e("div",Fe,[e("button",{class:"expense-button edit",onClick:x=>l.edit_flo_expenses(o)},"Edit",8,Be),e("button",{class:"expense-button remove",onClick:x=>l.remove_flo_expenses(o.id)},"Remove",8,Ne)])])]))),128))])):c("",!0),t.expenses_by_flo.length===0?(d(),h("p",Ve," You have not added any expenses today")):c("",!0)])])]),e("div",Oe,[De,Re,je,e("div",qe,[e("div",Ke,[e("form",{onSubmit:s[16]||(s[16]=f((...o)=>l.addForemanExpenses&&l.addForemanExpenses(...o),["prevent"])),class:"holder-padding"},[Ie,r(e("input",{type:"text","onUpdate:modelValue":s[13]||(s[13]=o=>t.foreman_purpose=o),required:""},null,512),[[p,t.foreman_purpose]]),Ge,r(e("input",{type:"text","onUpdate:modelValue":s[14]||(s[14]=o=>t.foreman_client=o)},null,512),[[p,t.foreman_client]]),Je,r(e("input",{type:"number","onUpdate:modelValue":s[15]||(s[15]=o=>t.foreman_amount=o),required:""},null,512),[[p,t.foreman_amount]]),e("button",{class:m([t.action,"submit holder-padding-submit"])},_(t.foreman_expenses_submit),3)],32)]),e("div",Ye,[e("label",Xe,"Available = "+_(l.foremanMoniesBalance.toLocaleString("en-US",{style:"currency",currency:"KES"})),1),ze,t.expenses_by_foreman.length>0?(d(),h("div",He,[(d(!0),h(w,null,v(t.expenses_by_foreman,o=>(d(),h("ul",{key:o.id},[e("li",null,[T(_(o.amount.toLocaleString("en-US"))+"\xA0\xA0\xA0"+_(o.purpose)+" ",1),e("div",Qe,[e("button",{class:"expense-button edit",onClick:x=>l.edit_foreman_expenses(o)},"Edit",8,We),e("button",{class:"expense-button remove",onClick:x=>l.remove_foreman_expenses(o.id)},"Remove",8,Ze)])])]))),128))])):c("",!0),t.expenses_by_foreman.length===0?(d(),h("p",$e," You have not added any expenses today")):c("",!0)])])]),e("div",es,[ss,ts,os,ns,as,r(e("input",{type:"date","onUpdate:modelValue":s[17]||(s[17]=o=>t.flo_start_date=o),required:""},null,512),[[p,t.flo_start_date]]),ls,r(e("input",{type:"date","onUpdate:modelValue":s[18]||(s[18]=o=>t.flo_end_date=o),required:""},null,512),[[p,t.flo_end_date]]),e("button",{class:m([t.action,"submit dashboard-submit"]),onClick:s[19]||(s[19]=(...o)=>l.get_expenses_by_flo_report&&l.get_expenses_by_flo_report(...o))},_(t.flo_expenses_report),3),is,rs,_s,r(e("input",{type:"date","onUpdate:modelValue":s[20]||(s[20]=o=>t.foreman_start_date=o),required:""},null,512),[[p,t.foreman_start_date]]),ps,r(e("input",{type:"date","onUpdate:modelValue":s[21]||(s[21]=o=>t.foreman_end_date=o),required:""},null,512),[[p,t.foreman_end_date]]),e("button",{class:m([t.action,"submit dashboard-submit"]),onClick:s[22]||(s[22]=(...o)=>l.get_foreman_expenses_report&&l.get_foreman_expenses_report(...o))},_(t.foreman_expenses_report),3),ds,us,hs,r(e("input",{type:"date","onUpdate:modelValue":s[23]||(s[23]=o=>t.monies_to_start_date=o),required:""},null,512),[[p,t.monies_to_start_date]]),ms,r(e("input",{type:"date","onUpdate:modelValue":s[24]||(s[24]=o=>t.monies_to_end_date=o),required:""},null,512),[[p,t.monies_to_end_date]]),e("button",{class:m([t.action,"submit dashboard-submit"]),onClick:s[25]||(s[25]=(...o)=>l.get_monies_to_foreman_report&&l.get_monies_to_foreman_report(...o))},_(t.monies_to_report),3)]),cs,g(C,N(t.changesModalProps,{onReloadExpenses:l.clearExpensesAndUpdate}),null,16,["onReloadExpenses"])])}var ys=k($,[["render",fs]]);export{ys as default};
